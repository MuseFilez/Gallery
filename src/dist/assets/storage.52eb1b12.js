var t=Object.defineProperty,e=Object.defineProperties,n=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(e,n,o)=>n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o;import{W as c}from"./vendor.061fb27f.js";function i(t){const e=document.getElementById("output");if(!e)return;const n=document.createElement("div");n.innerText=t,e.appendChild(n)}function l(t,e){const n=document.createElement("span");n.textContent=e;const o=document.createElement("span");o.className=t;const a=document.createElement("div");return a.appendChild(o),a.appendChild(n),a}function d(){var t;t="/settings.html",window.location.pathname!==t&&(window.location.pathname=t)}function u(t,e){return`https://${t}.ipfs.dweb.link/${encodeURIComponent(e)}`}function m(){return localStorage.getItem("w3storage-token")}function f(t){localStorage.setItem("w3storage-token",t)}function p(){localStorage.removeItem("w3storage-token")}function g(t){t.classList.add("hidden")}function h(t){t.classList.remove("hidden")}function w(){return location.hash.substring(1)}function y(t){location.hash="#"+t}function b(t){const e=document.createElement("a");e.target="_external",e.className="share-link",e.href=t;const n=l("fontawesome-share","View on IPFS");return e.appendChild(n),e}function v(t){const e=document.createElement("button");e.onclick=e=>{var n,o;e.preventDefault(),n=t,(o=document.createElement("textarea")).value=n,o.setAttribute("readonly",""),o.style={position:"absolute",left:"-9999px"},document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),k("Copied image URL to clipboard")};const n=l("fontawesome-paste","Copy sharing link");return e.appendChild(n),e}function k(t){const e=document.getElementById("snackbar");e&&(e.textContent=t,e.classList.add("show"),setTimeout((()=>e.classList.remove("show")),3e3))}const C="ImageGallery";async function I(t,e){const n=[C,e].join("|"),o=(a="metadata.json",s={path:t.name,caption:e},new File([JSON.stringify(s)],a));var a,s;const r=m();if(!r)return i("> ❗️ no API token found for Web3.Storage. You can add one in the settings page!"),void function(t){const e=document.getElementById("output");if(!e)return;const n=document.createElement("a");n.href=t,n.target="_external",n.innerText=`> 🔗 ${t}`,e.appendChild(n)}(`${location.protocol}//${location.host}/settings.html`);const l=new c({token:r});i(`> 🤖 calculating content ID for ${t.name}`);const d=await l.put([t,o],{name:n,onRootCidReady:t=>{i(`> 🔑 locally calculated Content ID: ${t} `),i("> 📡 sending files to web3.storage ")},onStoredChunk:t=>i(`> 🛰 sent ${t.toLocaleString()} bytes to web3.storage`)});return{cid:d,metadataGatewayURL:u(d,"metadata.json"),imageGatewayURL:u(d,t.name),imageURI:`ipfs://${d}/${t.name}`,metadataURI:`ipfs://${d}/metadata.json`}}async function*$(){const t=m();if(!t)return void console.error("No API token for Web3.Storage found.");const e=new c({token:t});for await(const o of e.list())if(o.name&&o.name.startsWith(C))try{const t=await j(o.cid);yield t}catch(n){console.error("error getting image metadata:",n);continue}}async function j(t){const c=u(t,"metadata.json"),i=await fetch(c);if(!i.ok)throw new Error(`error fetching image metadata: [${i.status}] ${i.statusText}`);const l=await i.json(),d=u(t,l.path),m=`ipfs://${t}/${l.path}`;return f=((t,e)=>{for(var n in e||(e={}))a.call(e,n)&&r(t,n,e[n]);if(o)for(var n of o(e))s.call(e,n)&&r(t,n,e[n]);return t})({},l),e(f,n({cid:t,gatewayURL:d,uri:m}));var f}async function E(t){console.log("validating token",t);const e=new c({token:t});try{for await(const t of e.list({maxResults:1}))break;return!0}catch(n){if(n.message.includes("401")||n.message.includes("403"))return console.log("invalid token",n.message),!1;throw n}}export{h as a,w as b,y as c,b as d,p as e,k as f,m as g,g as h,f as i,$ as l,v as m,d as n,I as s,E as v};
